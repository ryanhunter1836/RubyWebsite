const userElements = [
"name", 
"email", 
"password", 
"password_confirmation"
];

const shippingElements = [
"address1", 
"city", 
"state", 
"postal"
];

const userElementNames = [
    "Name",
    "Email",
    "Password",
    "Password confirmation"
]

const shippingElementNames = [
    "Address",
    "City",
    "State",
    "Zip code"
]

function inlineError(name, elementName, message) {
    messageElementName = elementName + "_error";
    fieldElementName = elementName + "_field";
    message = name + " " + message;
    messageElement = document.getElementById(messageElementName);
    messageElement.innerHTML = message;
    messageElement.classList.add("invalid-feedback");
    document.getElementById(fieldElementName).classList.add("is-invalid");
}

function clearErrors() {
    for(i = 0; i < userElements.length; i++) {
        messageElementName = userElements[i] + "_error";
        fieldElementName = userElements[i] + "_field";
        messageElement = document.getElementById(messageElementName);
        messageElement.innerHTML = "";
        messageElement.classList.remove("invalid-feedback");
        document.getElementById(fieldElementName).classList.remove("is-invalid");
    }
    for(i = 0; i < shippingElements.length; i++) {
        messageElementName = shippingElements[i] + "_error";
        fieldElementName = shippingElements[i] + "_field";
        messageElement = document.getElementById(messageElementName);
        messageElement.innerHTML = "";
        messageElement.classList.remove("invalid-feedback");
        document.getElementById(fieldElementName).classList.remove("is-invalid");
    }
}



$(document).on('ajax:success', '#user-form', event => {
    const [response, status, xhr] = event.detail;
    clearErrors();

    errors = false;

    //Loop through the user elements
    for(i = 0; i < userElements.length; i++) {
        if(userElements[i] in response) {
            inlineError(userElementNames[i], userElements[i], response[userElements[i]][0]);
            errors = true;
        }
    }

    //Loop through the shipping elements
    for(i = 0; i < shippingElements.length; i++) {
        key = "shipping_addresses." + shippingElements[i];
        if(key in response) {       
            inlineError(shippingElementNames[i], shippingElements[i], response[key][0]);
            errors = true;
        }
    }

    //Tell Stripe to process the payment
    if(!errors) {
        console.log("Processing payment");
    }
});